<!-- BURBUJA FLOTANTE -->
<div
  class="fixed bottom-8 right-8 z-50 bg-primary text-white w-14 h-14 rounded-2xl cursor-pointer shadow-[0_0_20px_rgba(99,102,241,0.5)] hover:shadow-[0_0_30px_rgba(99,102,241,0.8)] transition-all duration-300 flex items-center justify-center group border border-white/20 active:scale-90"
  [class.hidden]="productsCartService.isCartOpen()"
  (click)="toggleChat()"
>
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 group-hover:rotate-12 transition-transform">
    <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z" />
  </svg>
</div>

<!-- PANEL DEL CHAT -->
@if (isOpen()) {
<div class="fixed bottom-24 right-8 w-[350px] h-[500px] z-50 bg-neutral/80 backdrop-blur-xl rounded-3xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] flex flex-col border border-white/10 overflow-hidden animate-in fade-in slide-in-from-bottom-10 duration-300">
  
  <!-- Header -->
  <div class="bg-gradient-to-r from-primary to-secondary px-6 py-4 flex justify-between items-center relative overflow-hidden">
    <div class="absolute inset-0 bg-white/10 opacity-20 pointer-events-none"></div>
    <div class="flex items-center gap-3 relative z-10">
      <div class="w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center border border-white/30">
        <span class="text-lg">ðŸ¤–</span>
      </div>
      <div>
        <h3 class="font-bold text-white text-sm">Teslo Assistant</h3>
        <div class="flex items-center gap-1.5">
          <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
          <span class="text-[10px] text-white/70 uppercase tracking-widest font-bold">Online</span>
        </div>
      </div>
    </div>
    <button (click)="toggleChat()" class="text-white/80 hover:text-white transition-colors p-1 relative z-10">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <!-- Mensajes -->
  <div class="flex-1 overflow-y-auto p-6 space-y-4 bg-transparent custom-scrollbar">
    @for (msg of messages(); track $index) {
    <div class="flex flex-col" [ngClass]="{'items-end': msg.from === 'user', 'items-start': msg.from === 'bot'}">
      <div class="max-w-[85%] px-4 py-3 rounded-2xl text-sm leading-relaxed" 
           [ngClass]="{
            'bg-primary text-white rounded-tr-none shadow-lg shadow-primary/20': msg.from === 'user',
            'bg-white/10 backdrop-blur-md text-gray-200 border border-white/5 rounded-tl-none': msg.from === 'bot'
          }">
        {{ msg.text }}
      </div>
      <span class="text-[9px] text-gray-500 mt-1 px-1">{{ msg.from === 'user' ? 'TÃº' : 'Asistente' }}</span>
    </div>
    }
  </div>

  <!-- Input Area -->
  <div class="p-4 bg-black/20 border-t border-white/5">
    <div class="relative flex items-center gap-2">
      <input type="text" name="assistant" id="chat"
        class="flex-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 text-sm text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all backdrop-blur-md"
        placeholder="Escribe algo increÃ­ble..."
        [(ngModel)]="userMessage"
        (ngModelChange)="userMessage.set($event)"
        (keyup.enter)="sendMessage()" />
      
      <button 
        (click)="sendMessage()"
        class="bg-primary hover:bg-primary-focus text-white p-3 rounded-xl transition-all duration-300 shadow-lg shadow-primary/20 active:scale-95 disabled:opacity-50"
        [disabled]="!userMessage().trim()"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
        </svg>
      </button>
    </div>
  </div>
</div>
}

